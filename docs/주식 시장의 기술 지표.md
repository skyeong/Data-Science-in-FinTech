## 라이브러리 Import

```
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
plt.style.use('fivethirtyeight')
```

## 주식 데이터 로드
- 나스닥 종목 중에 2020년에 가장 뜨거웠던 테슬라 데이터를 예시로 사용하겠습니다.
- 2019년 12월 1일부터 2020년 11월 30일까지의 1년간 데이터를 yfinance를 이용하여 가져오겠습니다.
- yfinance 라이브러리가 없다면, '!pip install yfinance'를 통해서 설치해 주세요.

```
import yfinance as yf

df = yf.download('TSLA', start="2019-12-01", end="2020-11-30")
df['Date'] = df.index

df.head()
```

# 단순 이동 평균(SMA) 및 지수 이동 평균(EMA)을 계산하는 함수
- 이동 이동 평균에 주로 이용되는 시간 간격은 15, 20, 30일 입니다.
```
# 단순 이동 평균(SMA) 및 지수 이동 평균(EMA)을 계산하는 함수
- 이동 이동 평균에 주로 이용되는 시간 간격은 15, 20, 30일 입니다.

# 단순 이동 평균(Simple Moving Average, SMA)
def SMA(data, period=30, column='Close'):
  return data[column].rolling(window=period).mean()

# 지수 이동 평균(Exponential Moving Average, EMA)
def EMA(data, period=20, column='Close'):
  return data[column].ewm(span=period, adjust=False).mean()
```


# 이동평균 수럼/발산 계산 
- 이동평균 수렴/발산(Moving Average Convergence/Divergence, MACD)를 계산하는 함수를 만들어 보겠습니다. 
- 이동평균의 권장 기간은 장기 EMA의 경우 26일, 단기 EMA의 경우 12일, 신호선 EMA의 경우 9일입니다.

```
def MACD(data, period_long=26, period_short=12, period_signal=9, column='Close'):
  # 단기 지수 이평선 계산 (AKA Fast moving average)
  ShortEMA = EMA(data, period_short, column=column)

  # 장기 지수 이평선 계산 (AKA Slow moving average)
  LongEMA = EMA(data, period_long, column=column)

  # 이동 평균 수렴/발산 계산 
  data['MACD'] = ShortEMA - LongEMA

  # 신호선 계산 
  data['Signal_Line'] = EMA(data, period_signal, column='MACD')
  #data['MACD'].ewm(span=period_signal, adjust=False).mean()
      
  return data
```

# 상대적 강도 지수(RSI) 계산
- 상대적 강도 지수는 보통 14일 동안의 데이터를 사용하여 계산합니다. 

```
def RSI(data, period = 14, column = 'Close'):
  delta = data[column].diff(1) #Use diff() function to find the discrete difference over the column axis with period value equal to 1
  delta = delta.dropna() # or delta[1:]
  up =  delta.copy()  # delta 값 복사
  down = delta.copy() # delta 값 복사
  up[up < 0] = 0 
  down[down > 0] = 0 
  data['up'] = up
  data['down'] = down
  AVG_Gain = SMA(data, period, column='up')#up.rolling(window=period).mean()
  AVG_Loss = abs(SMA(data, period, column='down'))#abs(down.rolling(window=period).mean())
  RS = AVG_Gain / AVG_Loss
  RSI = 100.0 - (100.0/ (1.0 + RS))
  
  data['RSI'] = RSI
  return data
```


# 각 이동 평균값을 DataFrame에 추가하기
```
df = MACD(df, period_long=26, period_short=12, period_signal=9)
df = RSI(df, period=14)
df['SMA'] = SMA(df, period=30)
df['EMA'] = EMA(df, period=20)

df.tail()
```

# 이동 평균 수렴/발산과 신호선 시각화(MACD vs Signal Line)
